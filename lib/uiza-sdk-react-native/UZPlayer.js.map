{"version":3,"sources":["../../src/UZPlayer.js"],"names":["UZPlayer","props","self","Promise","resolve","Constants","getWebViewUserAgentAsync","then","res","_player","userAgent","deviceId","sessionId","inited","listener","onError","evt","onFullscreenUpdate","onFullscreenChange","onLoad","onLoaded","onLoadStart","onPlaybackStatusUpdate","onPlaybackChange","onReadyForDisplay","API","getAllConfig","api","appId","entityId","playerId","config","linkPlay","all","hls","hls_ts","mpd","hevc","items","map","linkPlays","url","Utils","urlToHttps","view","video","component","Expo","Video","RESIZE_MODE_CONTAIN","styles","init","onReady","getDefaultLinkPlay","loadAsync","uri","setStatusAsync","positionMillis","isLooping","shouldPlay","console","log","PlayerEvent","React","Component","StyleSheet","create","width","height","Platform","OS","parseInt","Version"],"mappings":"o1BAAA,4B,2CACA,yCACA,0BAGA,0B,uCACA,8B,2CACA,oC,+6BAEqBA,S,iEACnB,kBAAYC,KAAZ,CAAmB,0IACXA,KADW,GAGjBC,WAGAC,QAAQC,OAAR,CAAgBC,gBAAUC,wBAAV,EAAhB,EAAsDC,IAAtD,CAA2D,SAASC,GAAT,CAAc,CACvEC,QAAQC,SAAR,CAAoBF,GAApB,CACD,CAFD,EAGAC,QAAQE,QAAR,CAAmBN,gBAAUM,QAA7B,CACAF,QAAQG,SAAR,CAAoBP,gBAAUO,SAA9B,CACAH,QAAQI,MAAR,CAAiB,KAAjB,CACAJ,QAAQR,KAAR,CAAgBC,KAAKD,KAArB,CAEAQ,QAAQK,QAAR,CAAmB,CACjBC,QAAS,iBAASC,GAAT,CAAc,CACrB,GAAIP,QAAQR,KAAR,EAAiBQ,QAAQR,KAAR,CAAca,QAA/B,EAA2C,MAAOL,SAAQR,KAAR,CAAca,QAAd,CAAuBC,OAA9B,GAA0C,UAAzF,CAAqG,CACnGN,QAAQR,KAAR,CAAca,QAAd,CAAuBC,OAAvB,CAA+BC,GAA/B,EACD,CACF,CALgB,CAMjBC,mBAAoB,4BAASD,GAAT,CAAc,CAChC,GAAIP,QAAQR,KAAR,EAAiBQ,QAAQR,KAAR,CAAca,QAA/B,EAA2C,MAAOL,SAAQR,KAAR,CAAca,QAAd,CAAuBI,kBAA9B,GAAqD,UAApG,CAAgH,CAC9GT,QAAQR,KAAR,CAAca,QAAd,CAAuBI,kBAAvB,CAA0CF,GAA1C,EACD,CACF,CAVgB,CAWjBG,OAAQ,gBAASH,GAAT,CAAc,CACpB,GAAIP,QAAQR,KAAR,EAAiBQ,QAAQR,KAAR,CAAca,QAA/B,EAA2C,MAAOL,SAAQR,KAAR,CAAca,QAAd,CAAuBM,QAA9B,GAA2C,UAA1F,CAAsG,CACpGX,QAAQR,KAAR,CAAca,QAAd,CAAuBM,QAAvB,CAAgCJ,GAAhC,EACD,CACF,CAfgB,CAgBjBK,YAAa,qBAASL,GAAT,CAAc,CACzB,GAAIP,QAAQR,KAAR,EAAiBQ,QAAQR,KAAR,CAAca,QAA/B,EAA2C,MAAOL,SAAQR,KAAR,CAAca,QAAd,CAAuBK,MAA9B,GAAyC,UAAxF,CAAoG,CAClGV,QAAQR,KAAR,CAAca,QAAd,CAAuBK,MAAvB,CAA8BH,GAA9B,EACD,CACF,CApBgB,CAqBjBM,uBAAwB,gCAASN,GAAT,CAAc,CACpC,GAAIP,QAAQR,KAAR,EAAiBQ,QAAQR,KAAR,CAAca,QAA/B,EAA2C,MAAOL,SAAQR,KAAR,CAAca,QAAd,CAAuBS,gBAA9B,GAAmD,UAAlG,CAA8G,CAC5Gd,QAAQR,KAAR,CAAca,QAAd,CAAuBS,gBAAvB,CAAwCP,GAAxC,EACD,CACF,CAzBgB,CA0BjBQ,kBAAmB,2BAASR,GAAT,CAAc,CAEhC,CA5BgB,CAAnB,CAdiB,aA4ClB,C,sNAGwBS,cAAIC,YAAJ,CAAiBjB,QAAQR,KAAR,CAAc0B,GAA/B,CAAoClB,QAAQR,KAAR,CAAc2B,KAAlD,CAAyDnB,QAAQR,KAAR,CAAc4B,QAAvE,CAAiFpB,QAAQR,KAAR,CAAc6B,QAA/F,C,SAAvBrB,QAAQsB,M,oBACJtB,QAAQsB,MAAR,EAAkBtB,QAAQsB,MAAR,CAAeC,Q,0EAC7B7B,QACH8B,GADG,CACC,CACHxB,QAAQsB,MAAR,CAAeC,QAAf,CAAwBE,GADrB,CAEHzB,QAAQsB,MAAR,CAAeC,QAAf,CAAwBG,MAFrB,CAGH1B,QAAQsB,MAAR,CAAeC,QAAf,CAAwBI,GAHrB,CAIH3B,QAAQsB,MAAR,CAAeC,QAAf,CAAwBK,IAJrB,CADD,EAOH9B,IAPG,CAOE,eAAS,CACb,MAAO+B,OAAMC,GAAN,CAAU,mBAAa,CAC5B,MAAOC,WAAUD,GAAV,CAAc,kBAAY,CAC/BP,SAASS,GAAT,CAAeC,gBAAMC,UAAN,CAAiBX,SAASS,GAA1B,CAAf,CACA,MAAOT,SAAP,CACD,CAHM,CAAP,CAID,CALM,CAAP,CAMD,CAdG,C,SAgBRvB,QAAQI,MAAR,CAAiB,IAAjB,C,gCAEOJ,QAAQI,M,iGAOR,CACP,GAAM+B,MACJ,8BAAC,iBAAD,aAAU,KAAK3C,KAAf,mDACE,8BAAC,WAAD,EACE,IACE,uBAAa,CACXQ,QAAQoC,KAAR,CAAgBC,SAAhB,CACD,CAJL,CAME,kBAAmB,IANrB,CAOE,WAAYC,KAAKC,KAAL,CAAWC,mBAPzB,CAQE,MAAOC,OAAOL,KARhB,CASE,QAASpC,QAAQK,QAAR,CAAiBC,OAT5B,CAUE,mBAAoBN,QAAQK,QAAR,CAAiBG,kBAVvC,CAWE,OAAQR,QAAQK,QAAR,CAAiBK,MAX3B,CAYE,YAAaV,QAAQK,QAAR,CAAiBO,WAZhC,CAaE,uBAAwBZ,QAAQK,QAAR,CAAiBQ,sBAb3C,CAcE,kBAAmBb,QAAQK,QAAR,CAAiBU,iBAdtC,iDADF,CADF,CAqBArB,QAAQC,OAAR,CAAgBF,KAAKiD,IAAL,EAAhB,EAA6B5C,IAA7B,CAAkC,iBAAeC,GAAf,iIAC5BC,QAAQoC,KADoB,4CAG5B,GAAIpC,QAAQR,KAAR,EAAiBQ,QAAQR,KAAR,CAAca,QAA/B,EAA2C,MAAOL,SAAQR,KAAR,CAAca,QAAd,CAAuBsC,OAA9B,GAA0C,UAAzF,CAAqG,CACnG3C,QAAQR,KAAR,CAAca,QAAd,CAAuBsC,OAAvB,GACD,CACGX,GANwB,CAMlBY,mBAAmB5C,QAAQsB,MAAR,CAAeC,QAAlC,CANkB,kDAQtBvB,QAAQoC,KAAR,CAAcS,SAAd,CAAwB,CAAEC,IAAKd,GAAP,CAAxB,CARsB,0DAStBhC,QAAQoC,KAAR,CAAcW,cAAd,CAA6B,CACjCC,eAAgB,CADiB,CAEjCC,UAAW,IAFsB,CAGjCC,WAAY,IAHqB,CAA7B,CATsB,8FAgB5BC,QAAQC,GAAR,CAAY,SAAZ,eAhB4B,mEAAlC,EAqBA,MAAOjB,KAAP,CACD,C,mCAhDkB,CACjB,MAAOkB,gBAAP,CACD,C,sBAzEmCC,gBAAMC,S,kBAAvBhE,Q,CA0HrB,GAAIE,MAAO,IAAX,CACA,GAAIO,SAAU,EAAd,CAEA,GAAMyC,QAASe,wBAAWC,MAAX,CAAkB,CAC/BrB,MAAO,CACLsB,MAAO,MADF,CAELC,OAAQ,MAFH,CADwB,CAAlB,CAAf,CAOA,GAAMf,oBAAqB,QAArBA,mBAAqB,CAASb,SAAT,CAAoB,CAC7C,GAAI6B,sBAASC,EAAT,GAAgB,KAApB,CAA2B,CACzB,GAAIC,SAASF,sBAASG,OAAlB,CAA2B,EAA3B,GAAkC,EAAtC,CAA0C,CACxC,MAAOhC,WAAUN,GAAV,CAAc,CAAd,EAAiBO,GAAxB,CACD,CACF,CAJD,IAIO,CACL,GAAI8B,SAASF,sBAASG,OAAlB,CAA2B,EAA3B,GAAkC,EAAtC,CAA0C,CACxC,MAAOhC,WAAUJ,GAAV,CAAc,CAAd,EAAiBK,GAAxB,CACD,CACF,CAED,MAAOD,WAAUL,MAAV,CAAiB,CAAjB,EAAoBM,GAA3B,CACD,CAZD","file":"UZPlayer.js","sourcesContent":["import React from 'react';\nimport { Platform, StyleSheet, View } from 'react-native';\nimport { Video, Constants } from 'expo';\n\n// import Package from '../package.json';\nimport API from './API';\nimport PlayerEvent from './Event';\nimport Utils from './utils/Utils';\n\nexport default class UZPlayer extends React.Component {\n  constructor(props) {\n    super(props);\n\n    self = this;\n    // self.VERSION = Package.version;\n\n    Promise.resolve(Constants.getWebViewUserAgentAsync()).then(function(res) {\n      _player.userAgent = res;\n    });\n    _player.deviceId = Constants.deviceId;\n    _player.sessionId = Constants.sessionId;\n    _player.inited = false;\n    _player.props = self.props;\n\n    _player.listener = {\n      onError: function(evt) {\n        if (_player.props && _player.props.listener && typeof _player.props.listener.onError === 'function') {\n          _player.props.listener.onError(evt);\n        }\n      },\n      onFullscreenUpdate: function(evt) {\n        if (_player.props && _player.props.listener && typeof _player.props.listener.onFullscreenChange === 'function') {\n          _player.props.listener.onFullscreenChange(evt);\n        }\n      },\n      onLoad: function(evt) {\n        if (_player.props && _player.props.listener && typeof _player.props.listener.onLoaded === 'function') {\n          _player.props.listener.onLoaded(evt);\n        }\n      },\n      onLoadStart: function(evt) {\n        if (_player.props && _player.props.listener && typeof _player.props.listener.onLoad === 'function') {\n          _player.props.listener.onLoad(evt);\n        }\n      },\n      onPlaybackStatusUpdate: function(evt) {\n        if (_player.props && _player.props.listener && typeof _player.props.listener.onPlaybackChange === 'function') {\n          _player.props.listener.onPlaybackChange(evt);\n        }\n      },\n      onReadyForDisplay: function(evt) {\n        // console.log('onReadyForDisplay callback');\n      }\n    };\n  }\n\n  async init() {\n    _player.config = await API.getAllConfig(_player.props.api, _player.props.appId, _player.props.entityId, _player.props.playerId);\n    if (_player.config && _player.config.linkPlay) {\n      await Promise\n        .all([\n          _player.config.linkPlay.hls,\n          _player.config.linkPlay.hls_ts,\n          _player.config.linkPlay.mpd,\n          _player.config.linkPlay.hevc\n        ])\n        .then(items => {\n          return items.map(linkPlays => {\n            return linkPlays.map(linkPlay => {\n              linkPlay.url = Utils.urlToHttps(linkPlay.url);\n              return linkPlay;\n            });\n          });\n        });\n    }\n    _player.inited = true;\n\n    return _player.inited;\n  }\n\n  static get Event() {\n    return PlayerEvent;\n  }\n\n  render() {\n    const view = (\n      <View {...this.props}>\n        <Video\n          ref={\n            component => {\n              _player.video = component;\n            }\n          }\n          useNativeControls={true}\n          resizeMode={Expo.Video.RESIZE_MODE_CONTAIN}\n          style={styles.video}\n          onError={_player.listener.onError}\n          onFullscreenUpdate={_player.listener.onFullscreenUpdate}\n          onLoad={_player.listener.onLoad}\n          onLoadStart={_player.listener.onLoadStart}\n          onPlaybackStatusUpdate={_player.listener.onPlaybackStatusUpdate}\n          onReadyForDisplay={_player.listener.onReadyForDisplay}\n        />\n      </View>\n    );\n\n    Promise.resolve(self.init()).then(async function(res) {\n      if (_player.video) {\n        try {\n          if (_player.props && _player.props.listener && typeof _player.props.listener.onReady === 'function') {\n            _player.props.listener.onReady();\n          }\n          let url = getDefaultLinkPlay(_player.config.linkPlay);\n\n          await _player.video.loadAsync({ uri: url });\n          await _player.video.setStatusAsync({\n            positionMillis: 0, // for resume\n            isLooping: true,\n            shouldPlay: true\n          });\n\n        } catch (e) {\n          console.log('error: ', e);\n        }\n      }\n    });\n\n    return view;\n  }\n}\n\nlet self = null;\nlet _player = {};\n\nconst styles = StyleSheet.create({\n  video: {\n    width: '100%',\n    height: '100%',\n  }\n});\n\nconst getDefaultLinkPlay = function(linkPlays) {\n  if (Platform.OS === 'ios') {\n    if (parseInt(Platform.Version, 10) >= 10) {\n      return linkPlays.hls[0].url;\n    }\n  } else { // android\n    if (parseInt(Platform.Version, 10) >= 16) { // API 16 ~ android 4.1\n      return linkPlays.mpd[0].url;\n    }\n  }\n\n  return linkPlays.hls_ts[0].url;\n};\n"]}