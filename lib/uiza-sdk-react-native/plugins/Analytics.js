Object.defineProperty(exports,"__esModule",{value:true});exports.default=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _react=require('react');var _react2=_interopRequireDefault(_react);var _Utils=require('../utils/Utils');var _Utils2=_interopRequireDefault(_Utils);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var URL_DEV='https://dev-tracking.uizadev.io/analytic-tracking/v1/tracking/mobile';var URL_STAG='https://stag-tracking.uiza.io/analytic-tracking/v1/tracking/mobile';var URL_PROD='https://tracking.uiza.io/analytic-tracking/v1/tracking/mobile';var Analytics=function(){function Analytics(props){_classCallCheck(this,Analytics);this.props=props;this.state={playRequestTrigged:false,videoStartsTrigged:false,viewTrigged:false,playThrough25Trigged:false,playThrough50Trigged:false,playThrough75Trigged:false,playThrough100Trigged:false,initTime:Date.now(),playbackStatus:{}};}_createClass(Analytics,[{key:'init',value:function init(player,options){if(options){this.uzPlayer=player;this.options=options;this.options.readyTime=Date.now();if(this.props.stream==='vod'){this._track({'event_type':'display'});}}}},{key:'emit',value:function emit(evt,options){if(this.props.stream==='vod'){if(evt==='replay'){this._track({'event_type':'replay'});this.state.playRequestTrigged=false;this.state.videoStartsTrigged=false;this.state.viewTrigged=false;this.state.playThrough25Trigged=false;this.state.playThrough50Trigged=false;this.state.playThrough75Trigged=false;this.state.playThrough100Trigged=false;}}}},{key:'updatePlaybackStatus',value:function updatePlaybackStatus(playbackStatus){this.state.playbackStatus=playbackStatus;if(this.props.stream==='vod'){if(!this.state.playRequestTrigged){this.state.playRequestTrigged=true;this._track({'event_type':'plays_requested'});}if(!this.state.videoStartsTrigged&&playbackStatus.isPlaying){this.state.videoStartsTrigged=true;this._track({'event_type':'video_starts'});}if(!this.state.viewTrigged&&playbackStatus.positionMillis>=5e3){this.state.viewTrigged=true;this._track({'event_type':'view'});}if(!this.state.playThrough100Trigged){if(playbackStatus.positionMillis>=playbackStatus.durationMillis-2e3){this.state.playThrough100Trigged=true;this._track({'event_type':'play_through','play_through':100});}if(!this.state.playThrough75Trigged){if(playbackStatus.positionMillis/playbackStatus.durationMillis>=0.75){this.state.playThrough75Trigged=true;this._track({'event_type':'play_through','play_through':75});}if(!this.state.playThrough50Trigged){if(playbackStatus.positionMillis/playbackStatus.durationMillis>=0.5){this.state.playThrough50Trigged=true;this._track({'event_type':'play_through','play_through':50});}if(!this.state.playThrough25Trigged){if(playbackStatus.positionMillis/playbackStatus.durationMillis>=0.25){this.state.playThrough25Trigged=true;this._track({'event_type':'play_through','play_through':25});}}}}}}}},{key:'_track',value:function _track(options){if(this.options.entityDetail===null){return;}var opts={app_id:this.props.appId,device_id:this.uzPlayer.deviceId,entity_cdn:this.options.cdnList[0],entity_content_type:"video",entity_duration:this.state.playbackStatus.durationMillis?this.state.playbackStatus.durationMillis:0,entity_encoding_variant:"",entity_id:this.props.entityId,entity_language_code:"",entity_name:this.options.entityDetail.name,entity_producer:"",entity_series:"",entity_stream_type:"on-demand",entity_variant_id:"",entity_variant_name:"",event_type:"display",page_load_time:this.uzPlayer.pageLoadTime,page_type:"app",play_through:0,player_id:"null",player_init_time:this.state.initTime,player_name:"",player_startup_time:this.options.readyTime-this.state.initTime,player_version:this.uzPlayer.VERSION,referrer:"",timestamp:new Date().toISOString(),user_agent:this.uzPlayer.userAgent,viewer_user_id:""};for(key in options){opts[key]=options[key];}this._request(opts);}},{key:'_request',value:function _request(data){var callback=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var url,opt,response,responseJson;return regeneratorRuntime.async(function _request$(_context){while(1){switch(_context.prev=_context.next){case 0:url=URL_PROD;if(this.props.env==='stag'){url=URL_STAG;}else if(this.props.env==='dev'){url=URL_DEV;}_context.prev=2;opt={method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json'},body:JSON.stringify(data)};_context.next=6;return regeneratorRuntime.awrap(fetch(url,opt));case 6:response=_context.sent;_context.next=9;return regeneratorRuntime.awrap(response.json());case 9:responseJson=_context.sent;if(!(typeof callback==='function')){_context.next=12;break;}return _context.abrupt('return',callback({responseJson:responseJson}));case 12:return _context.abrupt('return',responseJson);case 15:_context.prev=15;_context.t0=_context['catch'](2);if(!(typeof callback==='function')){_context.next=19;break;}return _context.abrupt('return',callback(null));case 19:return _context.abrupt('return',null);case 20:case'end':return _context.stop();}}},null,this,[[2,15]]);}}]);return Analytics;}();exports.default=Analytics;
//# sourceMappingURL=Analytics.js.map