{"version":3,"sources":["../../../src/plugins/Analytics.js"],"names":["URL_DEV","URL_STAG","URL_PROD","Analytics","props","state","playRequestTrigged","videoStartsTrigged","viewTrigged","playThrough25Trigged","playThrough50Trigged","playThrough75Trigged","playThrough100Trigged","initTime","Date","now","playbackStatus","player","options","uzPlayer","readyTime","stream","_track","evt","isPlaying","positionMillis","durationMillis","entityDetail","opts","app_id","appId","device_id","deviceId","entity_cdn","cdnList","entity_content_type","entity_duration","entity_encoding_variant","entity_id","entityId","entity_language_code","entity_name","name","entity_producer","entity_series","entity_stream_type","entity_variant_id","entity_variant_name","event_type","page_load_time","pageLoadTime","page_type","play_through","player_id","player_init_time","player_name","player_startup_time","player_version","VERSION","referrer","timestamp","toISOString","user_agent","userAgent","viewer_user_id","key","_request","data","callback","url","env","opt","method","headers","body","JSON","stringify","fetch","response","json","responseJson"],"mappings":"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","file":"Analytics.js","sourcesContent":["import React from 'react';\nimport Utils, { Logger } from '../utils/Utils';\n\nconst URL_DEV = 'https://dev-tracking.uizadev.io/analytic-tracking/v1/tracking/mobile';\nconst URL_STAG = 'https://stag-tracking.uiza.io/analytic-tracking/v1/tracking/mobile';\nconst URL_PROD = 'https://tracking.uiza.io/analytic-tracking/v1/tracking/mobile';\n\nexport default class Analytics {\n  constructor(props) {\n    this.props = props;\n\n    this.state = {\n      playRequestTrigged: false,\n      videoStartsTrigged: false,\n      viewTrigged: false,\n      playThrough25Trigged: false,\n      playThrough50Trigged: false,\n      playThrough75Trigged: false,\n      playThrough100Trigged: false,\n      initTime: Date.now(),\n      playbackStatus: {}\n    };\n  }\n\n  init(player, options) {\n    if (options) {\n      this.uzPlayer = player;\n      this.options = options;\n      this.options.readyTime = Date.now();\n\n      if (this.props.stream === 'vod') {\n        this._track({ 'event_type': 'display' });\n      }\n    }\n  }\n\n  emit(evt, options) {\n    if (this.props.stream === 'vod') {\n      if (evt === 'replay') {\n        this._track({ 'event_type': 'replay' });\n        this.state.playRequestTrigged = false;\n        this.state.videoStartsTrigged = false;\n        this.state.viewTrigged = false;\n        this.state.playThrough25Trigged = false;\n        this.state.playThrough50Trigged = false;\n        this.state.playThrough75Trigged = false;\n        this.state.playThrough100Trigged = false;\n      }\n    }\n  }\n\n  updatePlaybackStatus(playbackStatus) {\n    this.state.playbackStatus = playbackStatus;\n    if (this.props.stream === 'vod') {\n      if (!this.state.playRequestTrigged) {\n        this.state.playRequestTrigged = true;\n        this._track({ 'event_type': 'plays_requested' });\n      }\n      if (!this.state.videoStartsTrigged && playbackStatus.isPlaying) {\n        this.state.videoStartsTrigged = true;\n        this._track({ 'event_type': 'video_starts' });\n      }\n      if (!this.state.viewTrigged && playbackStatus.positionMillis >= 5e3) {\n        this.state.viewTrigged = true;\n        this._track({ 'event_type': 'view' });\n      }\n      if (!this.state.playThrough100Trigged) {\n        if (playbackStatus.positionMillis >= playbackStatus.durationMillis - 2e3) {\n          this.state.playThrough100Trigged = true;\n          this._track({ 'event_type': 'play_through', 'play_through': 100 });\n        }\n        if (!this.state.playThrough75Trigged) {\n          if (playbackStatus.positionMillis / playbackStatus.durationMillis >= 0.75) {\n            this.state.playThrough75Trigged = true;\n            this._track({ 'event_type': 'play_through', 'play_through': 75 });\n          }\n          if (!this.state.playThrough50Trigged) {\n            if (playbackStatus.positionMillis / playbackStatus.durationMillis >= 0.5) {\n              this.state.playThrough50Trigged = true;\n              this._track({ 'event_type': 'play_through', 'play_through': 50 });\n            }\n            if (!this.state.playThrough25Trigged) {\n              if (playbackStatus.positionMillis / playbackStatus.durationMillis >= 0.25) {\n                this.state.playThrough25Trigged = true;\n                this._track({ 'event_type': 'play_through', 'play_through': 25 });\n              }\n            }\n          }\n        }  \n      }\n    }\n  }\n\n  _track(options) {\n    if (this.options.entityDetail === null) {\n      return;\n    }\n    var opts = {\n      app_id:                   this.props.appId,\n      device_id:                this.uzPlayer.deviceId,\n\n      entity_cdn:               this.options.cdnList[0],\n      entity_content_type:      \"video\",\n      entity_duration:          this.state.playbackStatus.durationMillis ? this.state.playbackStatus.durationMillis : 0,\n      entity_encoding_variant:  \"\",\n      entity_id:                this.props.entityId,\n      entity_language_code:     \"\",\n      entity_name:              this.options.entityDetail.name,\n      entity_producer:          \"\",\n      entity_series:            \"\",\n      entity_stream_type:       \"on-demand\",\n      entity_variant_id:        \"\",\n      entity_variant_name:      \"\",\n      event_type:               \"display\",\n      page_load_time:           this.uzPlayer.pageLoadTime,\n      page_type:                \"app\",\n      play_through:             0,\n      player_id:                \"null\",\n      player_init_time:         this.state.initTime,\n      player_name:              \"\",\n      player_startup_time:      this.options.readyTime - this.state.initTime,\n      player_version:           this.uzPlayer.VERSION,\n      referrer:                 \"\",\n      timestamp:                new Date().toISOString(),\n      user_agent:               this.uzPlayer.userAgent,\n      viewer_user_id:           \"\"\n    }\n    for (key in options) {\n      opts[key] = options[key];\n    }\n    this._request(opts);\n  }\n\n  async _request(data, callback = null) {\n    var url = URL_PROD;\n    if (this.props.env === 'stag') {\n      url = URL_STAG;\n    } else if (this.props.env === 'dev') {\n      url = URL_DEV;\n    }\n    try {\n      // options will extended into opt\n      const opt = {\n        method: 'POST',\n        headers: {\n          'Accept': 'application/json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data)\n      };\n\n      const response = await fetch(url, opt);\n      const responseJson = await response.json();\n\n      if (typeof callback === 'function') {\n        return callback({responseJson});\n      }\n\n      return responseJson;\n    } catch (e) {\n      if (typeof callback === 'function') {\n        return callback(null);\n      }\n      return null;\n    }\n  }\n}\n"]}